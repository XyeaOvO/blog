# 产品需求文档 (PRD)

**项目名称：** 透视投影几何偏差可视化实验室 (Perspective Projection Geometry Lab)

**版本：** 1.0

**状态：** 设计中

**目标：** 通过 3D 交互实验，直观证明在透视投影中，屏幕上的视觉中点不等于 3D 空间的中点。

---

## 1. 核心设计理念 (Core Concept)

*   **极简主义：** 模仿 Apple 官网或高端实验室的风格。纯白背景，高对比度色彩（红/绿/黑）。

*   **数学真实性：** 所有的几何偏差必须基于实时矩阵运算（Project/Unproject）。

*   **反馈即时：** 任何参数（如视角 FOV、物体距离）的改变，必须实时反映在视觉中点的位移上。

---

## 2. 交互实验流 (User Flow)

1.  **初始状态：** 屏幕中央展示一条从近处延伸到远处的斜线段。

2.  **交互：** 用户通过鼠标拖动视角（旋转/缩放）。

3.  **对比：** 界面实时显示两个球体：

*   **绿色球：** 3D 空间的数学中心。

*   **红色球：** 屏幕像素上的视觉中心。

4.  **动态调节：** 通过右侧滑块改变相机焦距（FOV），观察红绿球重合或分离的过程。

---

## 3. 功能需求 (Functional Requirements)

### 3.1 实验场景配置

*   **背景：** 无限纯白空间 (`#FFFFFF`)。

*   **地面：** 极淡颜色的网格线 (Grid Helper)，仅用于提供空间感知，不干扰视觉。

*   **灯光：** 柔和的环境光 + 具有物理感的一束平行光，使 3D 物体具有微小的阴影和质感。

### 3.2 实验对象 (The Experiment Row)

*   **主线段：** 一条黑色加粗的线段。

*   **端点：** A 点（近处）和 B 点（远处）。

*   **标记点 A（真实中点）：**

*   **颜色：** 绿色。

*   **逻辑：** 位于 $(A + B) / 2$ 的 3D 坐标处。

*   **标记点 B（投影中点）：**

*   **颜色：** 红色。

*   **逻辑：** 先计算 A 和 B 的屏幕 2D 像素坐标，求其中点 $M$，再将 $M$ 反向投影回 3D 线段上。

### 3.3 交互控制 (The Control Panel)

使用 **Leva** 库在右上角生成浮动面板，包含：

*   **相机焦距 (FOV)：** 调节从 10（接近正交投影）到 120（超广角透视）。

*   **线段长度/位置：** 允许用户改变 B 点的远近，观察随着深度增加，偏差如何扩大。

*   **视角切换：** 一键切换到“正视图”以观察平面上的偏差。

---

## 4. 技术栈选型 (Tech Stack)

| 模块 | 技术选型 | 理由 |

| :--- | :--- | :--- |

| **基础框架** | **React** | 方便管理 UI 状态（滑块数值与 3D 画面的联动）。 |

| **3D 引擎** | **React Three Fiber (R3F)** | 目前最高效的 Web 3D 开发方式。 |

| **3D 辅助** | **Drei** | 内置 `Line`, `Sphere`, `Html` 等现成组件，极大缩短开发周期。 |

| **UI 调试** | **Leva** | 自动生成美观的参数调节面板，符合“现代、交互”需求。 |

| **构建工具** | **Vite** | 毫秒级的开发启动速度和热重载。 |

| **编程语言** | **TypeScript** | 减少数学逻辑错误，提供智能补全。 |

---

## 5. 视觉规范 (Visual Specifications)

*   **调色板：**

*   背景：`#FFFFFF`

*   线段：`#1A1A1A` (深灰黑)

*   3D 中点：`#00FF88` (极客绿)

*   屏幕中点：`#FF3E00` (警示红)

*   **字体：** 系统默认的无衬线字体（San Francisco 或 Segoe UI），保持简洁感。

*   **动画：** 参数改变时，球体的移动应带有微小的平滑过渡效果（使用 `framer-motion` 或 `lerp` 算法）。

---

## 6. 数学逻辑

为了向用户解释清楚，系统需要实时计算：

1.  **3D Midpoint:** $P_{3d} = Vector3.lerp(A, B, 0.5)$

2.  **Screen Project:**

*   $A_{screen} = A.project(camera)$

*   $B_{screen} = B.project(camera)$

3.  **Visual Midpoint:** $M_{screen} = (A_{screen} + B_{screen}) / 2$

4.  **Inverse Project:** $P_{visual} = M_{screen}.unproject(camera)$，并将其约束在 $AB$ 连线上。

---

## 7. 验收标准 (Acceptance Criteria)

*   **性能表现：** 在普通笔记本浏览器上保持 60FPS 以上。

*   **响应式：** 浏览器窗口缩放时，3D 画布和 UI 自动适配，不产生形变。

*   **可视化效果：** 当用户开启“超广角”时，红色球（屏幕中心）应明显比绿色球更靠近远端。

*   **交互性：** 用户可以用鼠标任意旋转视角，观察这个偏差在不同角度下的表现。