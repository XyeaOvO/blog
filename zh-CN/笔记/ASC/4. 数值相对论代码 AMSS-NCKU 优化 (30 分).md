### 4. 数值相对论代码 AMSS-NCKU 优化（30分）

广义相对论是描述引力的基础理论。尽管它建立至今已有一个多世纪，但我们对广义相对论的理解仍然有限。其中一个主要原因是其控制动力学方程——爱因斯坦场方程，构成了物理学中最具挑战性的偏微分方程组之一。为了分析引力波探测数据，获得描述双黑洞并合的精确解至关重要。

继2015年首次观测到引力波这一里程碑式发现后，引力波探测获得了2017年诺贝尔物理学奖。这一突破在很大程度上归功于爱因斯坦场方程的数值解，它为信号识别和参数估计提供了必要的理论波形。阿里（Ali）是一个目前在中国建设和运行的引力波探测器，旨在将观测能力扩展到 $10^{-18}$ Hz 频段，从而开启通往此前未曾探索的引力波信号的大门。随着此类观测数据的获取，研究人员旨在探索宇宙的最早期时代，为大爆炸物理学和时空的本质提供新的见解，进一步确立引力波科学作为现代高性能计算的前沿应用地位。

用于数值求解爱因斯坦场方程的软件通常被称为数值相对论代码。全球已开发了多种数值相对论代码，但公开发布的寥寥无几。AMSS-NCKU 就是这样一种开放且可公开获取的数值相对论代码。AMSS-NCKU 采用有限差分法求解爱因斯坦场方程。为了解决广义相对论固有的多尺度性质，该代码利用了自适应网格细化（AMR）技术。在并行计算方面，AMSS-NCKU 采用了区域分解策略并结合了基于 MPI 的并行化。AMSS-NCKU 的计算工作流主要分为两个阶段。首先，代码求解爱因斯坦场方程的椭圆部分以生成初始数据。然后，AMSS-NCKU 求解爱因斯坦方程的双曲部分，以获得随后时间的时空度规。双曲演化方程的求解构成了 AMSS-NCKU 的主要计算工作负载。

关于 AMSS-NCKU 的双曲演化部分，有两个计算模块至关重要。第一个包括用于演化爱因斯坦场方程的龙格-库塔（Runge-Kutta）时间积分步骤。第二个涉及跨多层网格细化和分布式 MPI 进程的数据通信与同步。与典型的计算流体动力学（CFD）应用相比，爱因斯坦场方程涉及数十个未知变量。此外，时空度规场通常是平滑且连续的，这进一步将数值相对论与流体动力学问题区分开来。

**本任务的目标**是最小化总执行时间，程序运行结束时屏幕上将打印“This Program Cost = ** Seconds”（本程序耗时 = ** 秒）。

#### 工作流教程

AMSS-NCKU 的数值相对论模拟可以通过 Python 脚本启动，该脚本可在 GitHub 仓库 https://github.com/ASC-Competition 获取。克隆仓库后，您将找到 AMSS-NCKU 源文件（数值相对论模拟代码）和所需的 Python 文件（用于运行模拟的接口和脚本文件）。以下是 AMSS-NCKU 文件目录的示例：

```text
NR-amssncku/
|____amssncku
    |___ AMSS_NCKU_sources/   (AMSS-NCKU C++ 和 Fortran 源文件)
    |___ inputfile_examples/
    |___ makefile_include/    (编译 AMSS-NCKU 代码的有用示例)
    |___ AMSS_NCKU_Program.py (用于启动 AMSS-NCKU 模拟的 Python 脚本文件)
    |___ AMSS_NCKU_Input.py   (在此脚本文件中设置物理参数)
    |___......
```

要执行双黑洞模拟，请遵循以下步骤：

1.  **安装依赖项：** 确保已安装 `gcc`、`gfortran`、`nvcc` 和 `python3`。
    参考 `makefile_include` 中的示例，修改 `AMSS_NCKU_sources` 文件夹中的 `makefile.inc` 文件以匹配您的测试平台。仓库中提供了更多详细信息。
2.  **配置输入参数：** 在文件 `AMSS_NCKU_Input.py` 中，**严禁修改**方法或物理参数，**唯一的例外**是并行化参数。
3.  **构建并运行模拟：**
    在终端中执行以下命令：
    `$ python3 AMSS_NCKU_Program.py`
    代码将自动生成双黑洞模拟的所有输出文件。

#### 示例

这里我们要展示一个典型的双黑洞并合模拟示例。它对应于 2015 年由 LIGO 和 VIRGO 合作组捕获的首次观测到的引力波事件——GW150914。该引力波事件由一个双黑洞系统产生，其质量分别为 $M_1 = 36 M_\odot$ 和 $M_2 = 29 M_\odot$。当这两个大质量黑洞相互旋进并最终并合时，它们产生了极强的引力波信号。GW150914 做出了开创性的发现，因为它不仅直接证实了爱因斯坦关于引力波的预言，而且还开启了通过引力波天文学观测宇宙的新窗口。

在模拟中，AMSS-NCKU 使用“双穿刺（Two Puncture）”方法求解爱因斯坦方程的椭圆部分，并获得 t=0 时刻时空变量的初始数据。然后，使用自适应网格细化技术和有限差分格式评估爱因斯坦方程的双曲部分，以求解空间网格上的各种变量（为了降低计算成本，使用的是 4 阶有限差分格式，而不是更高阶的有限差分格式），这主导了双黑洞系统的时间演化。模拟中使用龙格-库塔方法进行时间积分。当 GW150914 事件的 AMSS-NCKU 模拟成功完成后，此模拟中的所有输出文件都存储在输出文件目录中，结构如下：

```text
GW150914/
|___ AMSS_NCKU_source_copy
|___ AMSS_NCKU_output
|___ figure
    |___ BH_Trajectory_XY.pdf
    |___ BH_Trajectory_21_XY.pdf
    |___ ADM_Constraint_Grid_Level_0.pdf
......
|___ AMSS_NCKU_Input.py
|___ AMSS-NCKU.input
|___ AMSS-NCKU-TwoPuncture.input
|___ AMSS_NCKU_Resolution
|___ Initial_Grid.pdf
|___ Initial_Grid.jpeg
|___ macrodef.h
|___ macrodef.fh
```

`BH_Trajectory_XY.pdf` 和 `BH_Trajectory_21_XY.pdf` 文件中的图表揭示了黑洞在旋进和并合过程中的轨迹等重要信息。图表 `ADM_Constraint_Grid_Level_0.pdf` 显示了最外层网格级别的**约束违反（constraint violation）**，这可以量化数值相对论模拟的精度。当在从 T = 0 到 T = 1000 的物理时间间隔内评估模拟时，黑洞轨迹呈现出以下特征：

![[Pic/Pasted image 20260118144200.png]]
![[Pic/Pasted image 20260118144218.png]]
![[Pic/Pasted image 20260118144239.png]]
#### 结果提交

在完成优化并执行 AMSS-NCKU 双黑洞并合模拟后，团队必须压缩输出目录“GW150914”，并按照上述规定将其作为“GW150914.tar.gz”上传到指定的 FTP 服务器。该目录必须包含前几节中列出的所有必需的输出文件。

#### 评估标准

评估将重点关注**结果的正确性**和所实现的**性能提升程度**。提案必须包含对所采用优化策略的详细描述，以及对底层技术原理的清晰解释。以下几点概述了评估的关键注意事项：

1.  参与者必须在压缩包中提交所有必需的文件。缺失文件将导致此部分得分为零。
2.  参与者必须提供详尽的文档，这将作为 ASC26 委员会评分的主要依据：
    *   安装过程
    *   机器规格
    *   优化策略
3.  对于双黑洞轨迹，优化后的结果必须满足以下标准：
    *   **精度要求：** 均方根误差（RMS error）——反映 `BH_Trajectory_XY.pdf` 中显示的数值偏差——必须保持在 **1% 以下**。
        $$ RMS = \sqrt{\frac{1}{M} \sum_{i=1}^{M} \left( \frac{|r_{1i} - r_{2i}|}{\max(r_{1i}, r_{2i})} \right)^2} $$
        其中 $r_{1i}$ 和 $r_{2i}$ 分别代表从优化前和优化后的测试中获得的黑洞轨迹坐标。$M$ 表示积分时间步长。
    *   **约束违反（Constraint Violation）：** 文件 `ADM_Constraint_Grid_Level_0.pdf` 展示了最外层网格级别上的约束违反情况。约束违反的绝对值不得超过 2，因为该指标用于定量衡量模拟的整体精度。
    *   **必需的提交材料：** 提案中必须包含以下三个文件：
        i. `BH_Trajectory_XY.pdf`
        ii. `BH_Trajectory_21_XY.pdf`
        iii. `ADM_Constraint_Grid_Level_0.pdf`

**未能通过验证测试或未提交所有指定文件将导致此部分的得分为零。**

**注意事项：**

1.  **严禁修改**任何与方法参数相关的代码。
2.  除了 MPI 处理器数量外，所有其他输入参数必须保持不变。
3.  请保持目录结构和生成的文件不变。
4.  ASC 组委会建议**仅使用 CPU 版本**，因为 GPU 版本已许久未维护，可能包含未知的错误（bug）。
5.  如果进行了优化，新算法必须在数学上等同于原始算法。
6.  不允许进行针对特定参数或特定案例的优化（Parameter-specific or case-specific optimizations）。
7.  本部分的提案内容不应超过 30 页。

如果您有任何问题或需要帮助，我们热诚邀请您通过 techsupport@asc-events.org 联系我们。我们的团队随时准备为您在 ASC26 的旅程中提供支持！

--结束--