我们可以把**版图 (Layout)** 理解为**建造芯片的“施工蓝图”**。它不是一张平面的图，而是一系列**层层叠加**的彩色图形，每一层都指示工厂（Foundry）在硅片上的特定位置做什么操作（例如，掺杂、沉积金属、刻蚀等）。

看懂版图，只需要掌握三个核心概念：**① 认图层**、**② 造晶体管**、**③ 做连接**。

---

### 核心概念 1: 认识图层 (The Layers) - 蓝图的“材料表”

版图中的每一种颜色或图案，都代表一种特定的物理材料或处理区域。就像地图的图例一样，你需要先知道每个颜色代表什么。我们以课程PPT中的图例（如Slide 34, 36）为例：

*   🟩 **扩散区 (Diffusion)**:
    *   `ndiff` (n-diffusion): N型掺杂区，用于构建**NMOS的源极和漏极**。
    *   `pdiff` (p-diffusion): P型掺杂区，用于构建**PMOS的源极和漏极**。
    *   可以把扩散区想象成晶体管的两个**“水池”**，电流就在这两个水池之间流动。

*   🟥 **多晶硅 (Polysilicon)**:
    *   这是版图中**最重要的图层之一**。它用于构成晶体管的**栅极 (Gate)**。
    *   可以把它想象成控制两个水池之间**“水流”的那个“闸门”**。

*   🟦 **金属 (Metal)**:
    *   `Metal1`, `Metal2`, ...: 用于在芯片上长距离**布线的“导线”**。
    *   `Metal1` 通常用于单元内部的短距离连接和电源轨。更高层的金属（M2, M3...）用于连接不同的逻辑单元。

*   ⬜ **阱 (Well)**:
    *   `N-well`: 一块N型掺杂区域，它是**建造PMOS管的“地基”**。所有的PMOS管都必须建在N-well里面。

### 核心概念 2: 建造晶体管 (Building Transistors) - 蓝图的“核心规则”

这是看懂版图最关键的一步。晶体管的形成有一个黄金法则：

> $\boxed{当“多晶硅 (Poly)”层跨越“扩散区 (Diffusion)”层时，一个晶体管就在它们的交叉处诞生了。}$

*   **多晶硅**形成了晶体管的**栅极 (Gate)**。
*   交叉处下方的**扩散区**被分成了两部分，分别构成了**源极 (Source)** 和 **漏极 (Drain)**。

**如何区分是NMOS还是PMOS？**

*   **NMOS**: 如果是**多晶硅** 跨越 **n-diffusion (ndiff)**，那么形成的就是 **NMOS**。
*   **PMOS**: 如果是**多晶硅** 跨越 **p-diffusion (pdiff)**，并且这个整体结构位于一个**N-well**区域内，那么形成的就是 **PMOS**。

### 核心概念 3: 实现连接 (Making Connections) - 蓝图的“胶水和电梯”

不同的图层之间通常被二氧化硅绝缘层隔开。为了将它们电性连接起来，我们需要“打孔”。

*   ⚫ **接触孔 (Contact)**:
    *   用于连接**Metal1** 和 **扩散区(Diffusion)** 或 **多晶硅(Poly)**。
    *   可以想象成将一楼的“导线”焊接到“元器件”上的焊点。

*   ❎ **过孔 (Via)**:
    *   用于连接**不同层的金属**，例如 `Metal1` 和 `Metal2`。
    *   可以想象成连接一楼和二楼的“电梯”或“楼梯”。

---

### 📝 实战演练：解读CMOS反相器版图 (Slide 34)

让我们用刚刚学到的知识来“反向工程”这个反相器的版图。

[图 34.1：CMOS反相器版图]

1.  **识别电源和地 (Power Rails)**:
    *   最上方和最下方的蓝色条纹区域是 **Metal1** 层，它们通常是宽大的电源轨。上面的是**VDD**，下面的是**GND**。

2.  **寻找晶体管 (黄金法则)**:
    *   找到那条垂直贯穿的**多晶硅 (Polysilicon)** 层。这是我们晶体管的“栅极”。
    *   **寻找PMOS**：看上半部分。这条多晶硅跨越了一块**p-diffusion**区域（图例中的pdiff），并且整个上半部分都在一个**N-well**里（虚线大框）。**Bingo！这就是我们的PMOS管。**
    *   **寻找NMOS**：看下半部分。这条多晶硅跨越了一块**n-diffusion**区域（图例中的ndiff）。**Bingo！这就是我们的NMOS管。**

3.  **追踪连接关系**:
    *   **输入 (Input A)**：那条垂直的**多晶硅**本身就是输入信号`A`的走线。因为它同时接触了PMOS和NMOS的栅极，所以它实现了将输入`A`同时连接到两个管子的功能。
    *   **输出 (Output Z)**：观察两个晶体管的中间。PMOS的**漏极**（p-diffusion的下半部分）和NMOS的**漏极**（n-diffusion的上半部分）通过**接触孔(Contact)**连接到了同一块**Metal1**上。这个公共连接点就是输出`Z`。
    *   **连接到VDD**: PMOS的**源极**（p-diffusion的上半部分）通过一个**接触孔**连接到了最上方的VDD金属轨。
    *   **连接到GND**: NMOS的**源极**（n-diffusion的下半部分）通过一个**接触孔**连接到了最下方的GND金属轨。

**结论**：通过解读，我们发现这个版图完美地实现了一个PMOS和一个NMOS的栅极相连、漏极相连、PMOS源极接VDD、NMOS源极接GND的结构——这正是**CMOS反相器的电路定义**！