非常好的提议！使用 `pre-commit` 是一个更现代化、更自动化的方案，可以极大地简化开发流程，并强制保证代码质量，避免了开发者忘记手动检查的麻烦。

我将按照您的要求，重写文档，将手动检查流程替换为 `pre-commit` 自动化工作流。

---

### **AI诗歌生成工具：项目需求文档 (Pre-commit 自动化版)**

#### **1. 项目概述**

本项目旨在开发一个基于循环神经网络（RNN/LSTM）的AI诗歌生成工具。该工具将使用Pytorch Lightning进行训练，并能够生成多种类型的古典中文诗词，包括：
*   **主题引导诗 (Prompt-based Poetry)**: 以用户给定的主题、标题或句子作为开头进行续写。
*   **藏头诗 (Acrostic Poetry)**: 根据用户提供的汉字生成藏头诗。
*   **常规诗 (Standard Poetry)**: 从单个字或词开始，自由生成诗句。

此文档详细说明了项目的技术要求、代码结构、模块功能及交付标准，旨在为开发人员提供一份清晰、可执行的实现蓝图。

#### **2. 技术规格**

*   **核心框架:** PyTorch & PyTorch Lightning
*   **配置管理:** Hydra
*   **实验跟踪:** Weights & Biases (WandB)
*   **环境管理:** Mamba
*   **代码规范与自动化:** Ruff & **Pre-commit**

#### **3. 项目与目录结构**

```
poetry-generator/
├── conf/                     # Hydra 配置文件目录
│   # ... (内容同前)
├── data/
│   └── poetry.txt            # 原始诗词数据集
├── src/
│   # ... (内容同前)
├── scripts/
│   └── run_sweep.sh          # 运行WandB Sweep的脚本
│
├── .pre-commit-config.yaml   # Pre-commit 钩子配置文件 (新增)
├── environment.yml           # Mamba 环境配置文件
├── pyproject.toml            # 项目配置，用于Ruff
├── sweep.yaml                # WandB Sweep 配置文件
├── .gitignore
└── README.md
```

#### **4. 环境与工具配置**

**4.1 Mamba 环境 (`environment.yml`)**
```yaml
name: poetry-generator
channels:
  - pytorch
  - nvidia
  - conda-forge
dependencies:
  - python=3.10
  - pytorch
  - torchvision
  - torchaudio
  - pytorch-cuda=11.8 # 可根据实际CUDA版本调整
  - pytorch-lightning
  - hydra-core
  - wandb
  - numpy
  - ruff
  - mamba
  - pre-commit # 新增 pre-commit
```

**4.2 Ruff 代码规范 (`pyproject.toml`)**
```toml
[tool.ruff]
select = ["E", "F"]
line-length = 88

[tool.ruff.format]
quote-style = "double"
```

**4.3 Pre-commit 钩子 (`.pre-commit-config.yaml`)**
```yaml
# See https://pre-commit.com for more information
# See https://pre-commit.com/hooks.html for more hooks
repos:
-   repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
    -   id: trailing-whitespace
    -   id: end-of-file-fixer
    -   id: check-yaml
    -   id: check-added-large-files
-   repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.1.6
    hooks:
    -   id: ruff
        args: [--fix, --exit-non-zero-on-fix]
    -   id: ruff-format
```

---

#### **5. 提交规范**

为保证代码库的整洁和历史记录的可读性，所有代码提交应遵循以下规范。

**5.1 Git 分支管理**
*   **`main` 分支**: 项目主分支，始终保持稳定。**禁止直接向 `main` 分支推送代码**。
*   **特性分支 (Feature Branch)**: 所有新功能、修复或文档都必须在新分支上进行。分支命名应采用 `类型/简短描述` 的格式 (e.g., `feature/add-generator-cli`, `fix/datamodule-bug`)。

**5.2 Commit 信息规范 (建议)**
为了清晰地追溯项目历史，**强烈建议**所有提交信息遵循 **Conventional Commits** 规范。
*   **格式**: `<type>(<scope>): <subject>`
*   **示例**:
    *   `feat(model): implement core lstm module`
    *   `fix(data): correct vocab saving path`
    *   `docs(readme): add usage instructions`

**5.3 自动化质量检查 (Pre-commit)**
本项目使用 `pre-commit` 框架在每次提交前自动执行代码质量检查（格式化与Linting）。
1.  **安装钩子**: 在首次克隆项目并创建环境后，必须在项目根目录运行以下命令来激活 `pre-commit`：
    ```bash
    pre-commit install
    ```
2.  **工作流程**:
    *   当你执行 `git commit` 时，`.pre-commit-config.yaml` 中定义的钩子会自动运行。
    *   如果代码不符合规范（例如，格式错误），钩子可能会自动修复它。修复后，你需要重新 `git add` 修改的文件，然后再次 `git commit`。
    *   如果钩子报告了无法自动修复的错误，你需要手动修复它们，然后才能成功提交。
    *   **所有提交到远程仓库的代码都必须能够通过 pre-commit 的所有检查。**

**5.4 Pull Request (PR) 流程**
1.  完成开发后，将特性分支推送到远程仓库。
2.  创建一个指向 `main` 分支的 Pull Request。
3.  PR 描述应清晰说明其**目的**、**主要变更**以及**如何测试**。

---

*(后续章节编号顺延，内容不变)*

#### **6. 模块实现细节**
(内容同前)

#### **7. 配置管理 (Hydra)**
(内容同前)

#### **8. 超参数搜索 (WandB Sweeps)**
(内容同前)

#### **9. 工作流程与代码质量**

1.  **自动化代码规范**: 所有代码提交前，**必须通过 `pre-commit` 的自动化检查**。这是强制性的。
2.  **README**: 撰写一份详细且现代化的`README.md`。

---

#### **10. 交付物与验收标准**

1.  **代码库:** 完整的、与本文档描述一致的代码库。
2.  **可复现性:**
    *   `mamba env create -f environment.yml` 必须成功创建环境。
    *   `pre-commit install` 必须能成功安装Git钩子。
    *   `python -m poetry_generator.pipelines.train` 必须无错启动训练。
    *   ... (其余标准不变)
3.  **功能性:**
    *   ... (功能标准不变)
4.  **代码质量:**
    *   所有提交的代码**必须通过 `.pre-commit-config.yaml` 中定义的自动化检查**。
    *   Git历史记录清晰，分支和提交信息遵循规范。
    *   代码逻辑清晰，遵循模块化和关注点分离原则。