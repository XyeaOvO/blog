
# 第九章：组合电路设计的艺术——从“静态”到“动态”的权衡

👋 **欢迎来到数字集成电路设计的“心脏”地带。**

如果说时序电路赋予了芯片“记忆”，那么组合逻辑电路就是芯片的“大脑”，负责所有的计算和决策。本章我们将不再满足于仅仅“画出”一个门电路，而是要学会像艺术家一样去**权衡**——在速度（Delay）、功耗（Power）、面积（Area）和鲁棒性（Robustness）之间寻找完美的平衡点。

---

## 🏗️ 第一部分：王者的基石——静态 CMOS 逻辑 (Static CMOS)

### 1.1 为什么静态 CMOS 是当今的主流？
**【了解】**
在进入复杂的电路之前，我们先回答一个根本问题：为什么在几十年的芯片发展史中，互补静态 CMOS（Complementary Static CMOS）逻辑最终统治了绝大多数数字电路？

答案在于两个字：**鲁棒（Robustness）**。

*   **⚡ 满幅摆动：** 它的输出要么是完美的 $V_{DD}$，要么是完美的 $GND$。这带来了极高的**噪声容限**。
*   **🚫 无静态功耗：** 在稳态下，VDD 到 GND 之间没有直通电流路径（Path），只有在开关切换的瞬间才消耗能量。
*   **💪 低输出阻抗：** 无论输出是高还是低，总有一条低阻抗通路连接到电源或地，这意味着它驱动负载的能力很强。

> $\boxed{\text{核心逻辑}}$：**PUN (Pull-Up Network)** 和 **PDN (Pull-Down Network)** 是互补的。PUN 导通时 PDN 必截止，反之亦然。这也是“互补（Complementary）”一词的由来。

`[图/表 3：静态 CMOS 的基本 PUN/PDN 结构示意图]`

---

### 1.2 性能调优：让静态 CMOS 跑得更快
**【核心考点】**
虽然静态 CMOS 很稳，但它不一定是最快的。当我们需要极致性能时，该如何优化？

#### 🔧 技巧一：逻辑努力（Logical Effort）与晶体管尺寸
不要凭感觉画版图。要计算最优的级数和尺寸，我们有公式：
$$ D = NF^{1/N} + P $$
*   **$N$**：路径的级数。
*   **$F$**：路径总的逻辑努力（Path Effort）。
*   **$P$**：寄生延时。

**一句话总结：** 最快的电路往往是让每一级承担相同的“努力”（Effort）。

#### 🔧 技巧二：输入排序（Input Ordering）
这是一个常被忽视的物理细节。
*   **现象：** 逻辑门的不同输入端，其物理位置和寄生电容是不同的。
*   **策略：** **把最晚到达的信号（Critical Signal）放在最靠近输出端的晶体管上。**
*   **原理：** 靠近内部的节点需要预先充电/放电。如果最晚的信号控制的是最靠近输出的管子，那么它到来之前，内部节点已经由其他早到的信号处理好了，它只需驱动最后一层，寄生延时最小。

`[图/表 15：输入顺序对延时的影响——内层输入最后翻转时延时最小]`

#### 🔧 技巧三：偏斜门（Skewed Gates）
**【重点】**
如果在这个电路中，我们只在乎**0变1**的速度，不在乎**1变0**的速度，怎么办？
*   **HI-skew 门：** 增大 PMOS 尺寸，让上升（0->1）变快。
*   **LO-skew 门：** 增大 NMOS 尺寸，让下降（1->0）变快。
*   **代价：** 牺牲了另一方向的转换速度，且噪声容限变差。

---

## 🚀 第二部分：速度与面积的挑战者——非静态逻辑家族

当静态 CMOS 的性能或面积无法满足极端需求时，我们需要引入更激进的电路结构。

### 2.1 有比逻辑（Ratioed Logic）与伪 NMOS
**【重点】**
**痛点：** 静态 CMOS 需要 $2N$ 个管子（N 个 PMOS + N 个 NMOS）。PMOS 既大又慢，导致输入电容大。

**解决方案：** 干掉 PMOS 网络！只用一个总是导通的弱 PMOS（或者电阻）作为负载，下面用 NMOS 网络进行逻辑运算。这就是**伪 NMOS（Pseudo-NMOS）**。

*   **✅ 优点：** 管子少（$N+1$ 个），输入电容小，面积小。
*   **❌ 缺点：**
    1.  **静态功耗：** 当输出为 0 时，PMOS 和 NMOS 同时导通，产生直通电流。
    2.  **比值失效（Ratioed Logic）：** 输出低电平 $V_{OL}$ 不是 0，而是由 PMOS 和 NMOS 的电阻比值决定的。如果 NMOS 不够强，$V_{OL}$ 可能无法被下一级识别为“低”。

`[图/表 28：伪 NMOS 电路结构，PMOS 栅极接地作为负载]`

### 2.2 动态电路（Dynamic Logic）
**【核心考点】**
**痛点：** 我们既想要快（没有 PMOS 的拖累），又想要省电（没有静态功耗）。

**解决方案：** 引入**时钟（Clock）**。将工作分为两个阶段：
1.  **预充阶段（Precharge, $\phi=0$）：** 输出节点被强制拉高到 $V_{DD}$。
2.  **求值阶段（Evaluate, $\phi=1$）：** 根据输入决定是否放电拉低。

*   **💀 致命弱点：单调性要求**
    在求值阶段，输入信号必须是**单调上升**的（只能 0->1，不能 1->0）。一旦在求值期间输入错误地变为 0，因为没有上拉路径，输出电荷一旦泄露就无法恢复，导致逻辑错误。

### 2.3 多米诺逻辑（Domino Logic）
为了解决动态电路不能直接级联（因为单调性问题）的缺陷，我们发明了**多米诺逻辑**。

*   **结构：** 动态门 + **静态反相器**。
*   **原理：** 动态门输出预充为高，经过反相器后变为低。下一级的输入初始就是低电平，只会单调上升（0->1），完美满足动态电路的要求。
*   **效果：** 像多米诺骨牌一样，信号级联传递。

`[图/表 41：多米诺逻辑结构——动态门后紧跟一个静态反相器]`

---

## ⚡ 第三部分：传输门逻辑 (Pass Transistor Logic)

**【了解】**
这是一种复古而高效的设计。
*   **思想：** 把晶体管当成“开关”来用，直接传递信号，而不是像 CMOS 那样仅仅用来驱动电源。
*   **问题：** NMOS 传高电平有损失（只能传到 $V_{DD}-V_{tn}$），PMOS 传低电平有损失（只能传到 $|V_{tp}|$）。
*   **终极形态：** **传输门（Transmission Gate）**。将 NMOS 和 PMOS 并联，互补控制。这样无论是传 0 还是传 1，都是满幅的。

---

## ⚠️ 第四部分：隐患与陷阱 (Circuit Pitfalls)

**【重点 - 必读】**
设计电路时，往往细节决定成败。这些是你必须避开的“坑”：

1.  **电荷分享（Charge Sharing）：**
    *   在动态电路中，当堆叠的管子部分导通时，输出节点的电荷会流向内部节点电容，导致输出电压意外下降。
2.  **竞争与冒险（Race Condition）：**
    *   信号到达时间不一致导致的瞬间错误脉冲（Glitch）。
3.  **电源噪声（IR Drop）：**
    *   电流过大导致电源线上压降，使得实际供电电压降低，不仅变慢，还降低噪声容限。
4.  **热斑（Hot Spots）：**
    *   局部功耗过高导致温度剧增，影响可靠性。
5.  **少数载流子注入：**
    *   信号过冲导致PN结正偏，电流注入衬底，干扰其他逻辑门（可能导致闩锁 Latch-up）。

---

## 🧪 第五部分：前沿技术与低功耗

当摩尔定律放缓，我们开始寻找新材料和新模式。

### 5.1 SOI 技术 (Silicon-On-Insulator)
*   **是什么：** 在绝缘层（埋氧层）上构建晶体管，而不是直接做在硅衬底上。
*   **为什么：**
    1.  **寄生电容极小：** 速度快，功耗低。
    2.  **无闩锁效应：** 因为元件之间完全隔离。
*   **分类：**
    *   **PD-SOI（部分耗尽）：** 制造简单，适合射频（RF-SOI）。
    *   **FD-SOI（全耗尽）：** 沟道极薄，控制力极强，漏电低。

### 5.2 亚阈值电路 (Sub-threshold Circuits)
*   **极致低功耗：** 让电路工作在阈值电压（$V_{th}$）以下。利用漏电流（Leakage Current）来工作！
*   **代价：** 极慢。
*   **应用：** 心脏起搏器、电子表等对速度要求不高但对电池寿命极敏感的场合。

---

## 📝 课后思考与自测

1.  **比较题：** 同样实现一个逻辑功能，静态 CMOS、伪 NMOS 和多米诺逻辑，谁的面积最小？谁的速度最快？谁的噪声容限最高？
2.  **分析题：** 为什么动态电路必须要求输入单调变化？如果不单调会发生什么？
3.  **计算题：** 尝试用逻辑努力（Logical Effort）的方法，计算一个 4 输入与非门驱动大负载时的最优级数。

> **下章预告：** 搞定了组合逻辑，我们只是拥有了瞬间的智慧。下一章，我们将引入“时间”的概念，学习**时序电路设计**，让芯片拥有记忆。